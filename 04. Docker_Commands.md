## Django Project Template
Template to get started quickly with Django, PostgreSQL and Docker.

### Document URL
```
https://learn.microsoft.com/en-us/windows/wsl/install
```

### Step 1: Install Ubuntu - CMD or PowerShell
```sh
wsl --install
```
Or install from Microsoft Store

### Step 2: Update Ubuntu
```sh
sudo apt-get update
```

### Step 3: Install Docker Desktop
Choose your operating system:
- Windows: https://docs.docker.com/desktop/install/windows-install/
- Linux: https://docs.docker.com/desktop/install/linux-install/
- macOS: https://docs.docker.com/desktop/install/mac-install/

### Step 4: Install Docker on Server
```bash
# Official one-liner
curl -fsSL https://get.docker.com | sudo sh

# Install the modern Compose plugin (NOT the old python package)
sudo apt update && sudo apt install -y docker-compose-plugin
sudo apt install docker-compose

# Start and enable
sudo systemctl enable --now docker

# Allow running without sudo
sudo usermod -aG docker $USER
# → Log out and back in for changes to take effect
```

### Verify Docker Installation
```bash
sudo systemctl start docker
sudo systemctl enable docker
docker --version
docker run hello-world
```

### Run Docker Without Sudo
```bash
sudo usermod -aG docker $USER
newgrp docker  # Apply group changes without logout
```

## Usage

Navigate to your project directory:
```bash
cd /path/to/your/project
```

### Docker Compose Commands

#### Build & Run
```bash
docker-compose up                              # Build from scratch with logs
docker-compose up --build                      # Rebuild and show logs
docker-compose up -d --build                   # Rebuild in detached mode (no logs)
docker-compose up -d --build --remove-orphans  # Rebuild and clean orphan containers
docker-compose -f custom.yml up                # Use custom compose file
```

#### Monitor & Debug
```bash
docker-compose ps                              # List running services
docker-compose logs -f                         # View all logs (follow mode)
docker-compose logs -f web                     # View specific service logs
docker-compose logs -f celery_worker           # View Celery worker logs
docker stats                                   # Monitor all containers
docker stats container_name                    # Monitor specific container
docker-compose top                             # Display running processes
```

#### Rebuild Container Safely
Merge conflight / quick solution in server
```bash
git fetch --all
git reset --hard origin/master
```
```bash
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

#### Stop & Remove
```bash
docker-compose stop                            # Stop services (keeps containers)
docker-compose down                            # Remove containers & networks
docker-compose down --remove-orphans           # Remove containers & orphans
docker-compose down -v                         # Remove containers & volumes (⚠️ DESTRUCTIVE)
docker rm -f container_name                    # Force remove specific container
```

#### Clean Up
```bash
docker system prune                            # Remove unused data
docker system prune -a                         # Remove all unused images
docker system prune -af --volumes              # Remove everything unused (⚠️ DESTRUCTIVE)
docker volume prune                            # Remove unused volumes
docker image prune -a                          # Remove unused images
```

#### Access Containers
```bash
docker-compose exec web sh                     # Interactive shell (sh)
docker-compose exec web bash                   # Interactive shell (bash)
docker exec -it container_name bash            # Access container directly
exit                                           # Exit container (or Ctrl + D)
```

### Django Management Commands
```bash
# Migrations
docker compose exec <service_name> python manage.py makemigrations
docker compose exec <service_name> python manage.py migrate
docker compose exec <service_name> python manage.py showmigrations

# User Management
docker compose exec <service_name> python manage.py createsuperuser

# Database
docker compose exec -it <service_name> python manage.py dbshell
docker compose exec <service_name> python manage.py dumpdata > backup.json
docker compose exec <service_name> python manage.py loaddata backup.json

# Static Files
docker compose exec <service_name> python manage.py collectstatic --noinput

# Shell
docker compose exec -it <service_name> python manage.py shell
docker compose exec -it <service_name> python manage.py shell_plus   # If django-extensions installed

# Testing
docker compose exec <service_name> python manage.py test
docker compose exec <service_name> pytest  # If using pytest

# Other Useful Commands
docker compose exec <service_name> python manage.py check
docker compose exec <service_name> python manage.py runserver 0.0.0.0:8000
```

## Docker Quick Reference

### Container Lifecycle
| Command | Description |
| ---------------------------- | ------------------------- |
| `docker start <container>` | Start a stopped container |
| `docker stop <container>` | Stop a running container |
| `docker restart <container>` | Restart a container |
| `docker kill <container>` | Force stop a container |
| `docker pause <container>` | Pause all processes |
| `docker unpause <container>` | Resume paused processes |

### Container Management
| Command | Description |
| --------------------------------------- | ---------------------------------------- |
| `docker ps` | List running containers |
| `docker ps -a` | List all containers (running + stopped) |
| `docker rm <container>` | Remove a stopped container |
| `docker rm -f <container>` | Force remove a running container |
| `docker run -it <image> bash` | Run a container interactively with shell |
| `docker exec -it <container> bash` | Enter a running container's shell |
| `docker exec -it <container> <command>` | Run a command in a container |
| `docker inspect <container>` | View detailed container info |
| `docker logs <container>` | View container logs |
| `docker logs -f <container>` | Follow container logs in real-time |

### File Operations & Volumes
| Command | Description |
| --------------------------------------------- | --------------------------- |
| `docker cp <container>:/path/to/file ./local` | Copy from container to host |
| `docker cp ./local <container>:/path/to/file` | Copy from host to container |
| `docker volume ls` | List Docker volumes |
| `docker volume inspect <volume>` | View volume details |
| `docker volume rm <volume>` | Remove a Docker volume |
| `docker volume prune` | Remove all unused volumes |

### Image Management
| Command | Description |
| ----------------------------- | ------------------------------- |
| `docker images` | List all images |
| `docker pull <image>` | Download an image |
| `docker rmi <image>` | Remove an image |
| `docker rmi -f <image>` | Force remove an image |
| `docker image prune` | Remove unused images |
| `docker build -t <name> .` | Build image from Dockerfile |
| `docker tag <image> <tag>` | Tag an image |

### Network Management
| Command | Description |
| ----------------------------- | ------------------------ |
| `docker network ls` | List networks |
| `docker network inspect <id>` | View network details |
| `docker network create <name>` | Create a network |
| `docker network rm <name>` | Remove a network |
| `docker network prune` | Remove unused networks |

## Troubleshooting

### Common Issues

**Permission denied errors:**
```bash
sudo usermod -aG docker $USER
newgrp docker
```

**Port already in use:**
```bash
# Find process using port
sudo lsof -i :8000
# Kill process
sudo kill -9 <PID>
```

**Database connection errors:**
```bash
# Check if PostgreSQL container is running
docker-compose ps
# View database logs
docker-compose logs db
```

**Build cache issues:**
```bash
# Rebuild without cache
docker-compose build --no-cache
docker-compose up -d --build --force-recreate
```

**Reset everything:**
```bash
docker-compose down -v
docker system prune -af --volumes
docker-compose up -d --build
```

## Best Practices

1. **Never use `-v` flag in production** - it deletes all data
2. **Always backup before major changes** - Use `docker-compose exec db pg_dump`
3. **Use `.dockerignore`** - Exclude unnecessary files from builds
4. **Keep images small** - Use multi-stage builds
5. **Use volumes for persistent data** - Never store data in containers
6. **Log out and back in** after adding user to docker group
7. **Use specific image versions** - Avoid `latest` tag in production
8. **Monitor resource usage** - Use `docker stats` regularly

## Additional Resources

- Django Documentation: https://docs.djangoproject.com/
- Docker Documentation: https://docs.docker.com/
- Docker Compose Documentation: https://docs.docker.com/compose/
- PostgreSQL Documentation: https://www.postgresql.org/docs/
